<div class="dropdown-container">
  <label for="subjectDropdown" class="dropdown-label">Избери предмет:</label>
  <select
    id="subjectDropdown"
    [(ngModel)]="selectedSubjectId"
    (change)="onSubjectChange()"
    class="dropdown-select"
  >
    <option *ngFor="let subject of subjects" [value]="subject.id">
      {{ subject.title }}
    </option>
  </select>
</div>

<div class="students-grid">
  <div *ngFor="let student of studentsWithGrades" class="student-card">
    <h3 class="student-name">{{ student.name }}</h3>

    <div class="grades-table-wrapper">
      <table class="grades-table">
        <thead>
          <tr>
            <th rowspan="2">Предмет</th>
            <th colspan="2">I срок</th>
            <th colspan="2">II срок</th>
            <th rowspan="2">Годишна</th>
            <th rowspan="2" style="width: 50px">
              <!-- Add Grade column header -->
              <!-- <button
                mat-icon-button
                color="primary"
                aria-label="Добави оценка"
                (click)="addGrade(student.id)"
                title="Добави оценка"
              >
                <mat-icon>add</mat-icon>
              </button> -->
            </th>
          </tr>
          <tr>
            <th>Текущи</th>
            <th>Срочна</th>
            <th>Текущи</th>
            <th>Срочна</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ student.grades.subject }}</td>
            <td>
              <ng-container *ngFor="let g of student.grades.winter.tekushta">
                <span
                  class="grade-chip"
                  [ngClass]="getGradeClass(g.grade)"
                  (click)="openEditGradeDialog(student, g)"
                >
                  {{ g.grade }}
                </span>
              </ng-container>
            </td>
            <td>
              <ng-container *ngFor="let g of student.grades.winter.srochna">
                <span
                  class="grade-chip"
                  [ngClass]="getGradeClass(g.grade)"
                  (click)="openEditGradeDialog(student, g)"
                >
                  {{ g.grade }}
                </span>
              </ng-container>
            </td>
            <td>
              <ng-container *ngFor="let g of student.grades.spring.tekushta">
                <span
                  class="grade-chip"
                  [ngClass]="getGradeClass(g.grade)"
                  (click)="openEditGradeDialog(student, g)"
                >
                  {{ g.grade }}
                </span>
              </ng-container>
            </td>
            <td>
              <ng-container *ngFor="let g of student.grades.spring.srochna">
                <span
                  class="grade-chip"
                  [ngClass]="getGradeClass(g.grade)"
                  (click)="openEditGradeDialog(student, g)"
                >
                  {{ g.grade }}
                </span>
              </ng-container>
            </td>
            <td>
              <ng-container *ngFor="let g of student.grades.godishna">
                <span
                  class="grade-chip"
                  [ngClass]="getGradeClass(g.grade)"
                  (click)="openEditGradeDialog(student, g)"
                >
                  {{ g.grade }}
                </span>
              </ng-container>
            </td>
            <td>
              <!-- Add Grade button inside row -->
              <button
                mat-icon-button
                color="primary"
                aria-label="Добави оценка"
                (click)="addGrade(student.id)"
                title="Добави оценка"
              >
                <mat-icon>add</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
